@model KL.Models.DatabaseModels.HoSoNhanSu


<div id="page-wrapper">
    <div class="row" id="content">
        <div class="col-lg-12">
            <h1 class="page-header">Dashboard</h1>
            <div class="">
                <input type="radio" id="toggle-on" name="toggle" checked>
                <label for="toggle-on">Chủ trì</label>
                <input type="radio" id="toggle-off" name="toggle">
                <label for="toggle-off">Tham Gia</label>
            </div>
            <div class="card mb-3">
                <div class="card-header">
                    <i class="fas fa-table"></i>
                    Cong Viec Moi
                </div>

                <div class="card-body " id="toggle-ontable">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>Stt</th>
                                    <th>Ten Cong Viec</th>
                                    <th>Noi Dung Tom Tat</th>
                                    <th>File Dinh Kem</th>
                                    <th>Thoi Gian Hoan Thanh</th>
                                    <th>Thuoc Cong Viec</th>
                                </tr>
                            </thead>
                            @using KL.Models.DatabaseModels;
                            @{
                                var db = new Smof();
                                var cvPhong = Model.CongViecPhongs.Where(m => m.ChuTri == 1 && m.New == 0).OrderBy(m => m.Datecreate);
                                foreach (var item in db.CongViecPhongs.Where(m => m.HoSoNhanSu.ID == Model.ID))
                                {
                                    item.TrangThai = 1;
                                    item.New = 1;
                                }
                                db.SaveChanges();
                            }
                            <tbody>
                                @foreach (var cv in cvPhong)
                                {
                                    cv.New = 1;
                                    cv.TrangThai = 1;
                                    <tr class="@cv.ID">
                                        <td>@(cvPhong.ToList().IndexOf(cv) + 1)</td>
                                        <td>@cv.Ten</td>
                                        <td>@cv.NoiDungChitiet</td>
                                        <td>@cv.CongVanDinhKem</td>
                                        <td>@cv.ThoiGianHoanThanh</td>
                                        <td>@db.CongViecs.Where(m=>m.ID==cv.IDCongViec).FirstOrDefault().ID</td>

                                        <td><button id="add">add plan</button></td>
                                    </tr>
                                }
                            </tbody>


                        </table>
                    </div>
                </div>
                <div class="card-body " style="display: none;" id="toggle-offtable">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>Stt</th>
                                    <th>Ten Cong Viec</th>
                                    <th>Noi Dung Tom Tat</th>
                                    <th>File Dinh Kem</th>
                                    <th>Thoi Gian Can Hoan Thanh</th>
                                    <th>Cong Viec Phong</th>
                                </tr>
                            </thead>
                            @{ 
                                var cvCnhan = Model.CongViecCaNhans.Where(m => m.New == 0);
                                
                                foreach(var item in db.CongViecCaNhans.Where(m => m.HoSoNhanSu.ID == Model.ID))
                                {
                                    item.TrangThai = 1;
                                    item.New = 1;
                                }
                                db.SaveChanges();

                            }
                            <tbody id="cvcn">
                                @foreach (var cv in cvCnhan)
                                {
                                    
                                    <tr id="@cv.ID">
                                        <td>@(cvCnhan.ToList().IndexOf(cv) + 1)</td>
                                        <td>@cv.Ten</td>
                                        <td>@cv.NoiDungCongViec</td>
                                        <td>@cv.SanPhamCaNhan</td>
                                        <td>@cv.ThoiGianHoanThanh</td>
                                        <td>@db.CongViecPhongs.Where(m=>m.ID==cv.IDCongViecPhong).FirstOrDefault().Ten</td>
                                        <td><button class="view">view</button></td>
                                    </tr>
                                }
                            </tbody>


                        </table>
                    </div>
                    <script>
                        $('button.view').click(function () {
                            var rowclick = '#' + $(this).closest('tr').attr('id');
                            $(rowclick).remove();
                            
                        });
                    </script>
                </div>
                <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
            </div>
        </div>
        <!-- /.col-lg-12 -->
        @db.SaveChanges();
    </div>
    <div id="tt"></div>
</div>

<link href="~/Assets/dist/css/Style.css" rel="stylesheet" />
<div id="myModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span id="chutri" class="close">&times;</span>

        </div>
        <div class="modal-body">
            <div class="card-body toggle-on" id="0">
                <div class="table-responsive">
                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Stt</th>
                                <th>Ten Cong Viec</th>
                                <th>Noi Dung Tom Tat</th>
                                <th>Nguoi tham gia</th>
                                <th>Thoi Gian Hoan Thanh</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td></td>
                                <td><input type="text" id="tenCv" class="ten" /></td>
                                <td><input type="text" id="noidung" class="nd" /></td>
                                <td id="dropdownlist"> @Html.DropDownList("employee", (IEnumerable<SelectListItem>)ViewBag.CategoryList, "select one")</td>
                                <td><input type="text" id="tgian" class="nd" /></td>
                            </tr>
                        </tbody>

                    </table>
                    <button id="addTask">Add task</button>
                </div>
            </div>
        </div>

        <div>
            <button class="btn-success" id="savePlan" type="button">Save</button>
        </div>
    </div>
    <script>
        var myModal = $('#myModal').html();
        var planIndex;

        $('#addTask').click(function () {
            var data1 = "<td>" + $('#dropdownlist').clone().html() + "</td>";
            var data = "<tr><td></td><td><input type='text'class='ten'/></td><td><input type='text'  class='nd'/></td>" + data1 + "<td>2011/04/25</td>" + "/<tr>";
            $('#myModal tbody').append(data);


        });
        var t = myModal;
        var modal = document.getElementById('myModal');
        $('button#add').click(function () {
            planIndex = $(this).closest('tr').attr('class');

            $('#myModal').show();
            //alert($('.modal').attr('id'));
    });

        $(document).click(function (event) {
            if (event.target == $('#myModal')[0]) {
                var tt = '<div id="myModal" class="modal">' + myModal + '</div>';

                $('#myModal').replaceWith(tt);
                $('#myModal').hide();


            };

        });
        $('span#chutri').click(function () {
            $('#myModal').hide();
        })
    $('button#savePlan').click(function () {
        var data = []; var i = 0;
        $('#myModal').hide();
        $('#myModal tbody tr').each(function () {
            var dropList = $(this).find('option:selected').val();
            var deadline = $(this).find('.tgian').val();
            data[i] = {
                Ten: $(this).find('.ten').val(),
                Noidung: $(this).find('.nd').val(),
                IDHs: dropList,
                DeadLine:deadline
            };
            i++;
        });
        var kh = new Object();
        kh.ID = planIndex;
        kh.newPlans = data;
        $.ajax({
            url: '/Job/SaveNew',
            type: 'POST',
            data: { kh: kh,IdNhanSu:@Model.ID },

            success: function (response) {

                $('tr.' + planIndex).remove();

                //$('#page-wrapper').replaceWith($(response));

                //$("html").html($("html", response).html());
            }
        });
        /*$.ajax({
            url: '/Left/Left?hsId',
            type: "POST",
            success: function (data) {
                $('#left').replaceWith(data);
            }
        });*/

    });
    $('.edit').click(function () {
        alert("tuan");
        $(this).hide();
    });
    </script>
</div>
<!-- Modal content -->
<script>

    $('input:radio').change(function () {

        var radioButtons = $("input:radio[name='toggle']");
        var selectedIndex = radioButtons.index(radioButtons.find(':checked'));
        var idRadio = $(this).attr('id');
        if (idRadio == 'toggle-on') {
            idTable2 = '#' + 'toggle-off' + 'table';
        }
        else {
            idTable2 = '#' + 'toggle-on' + 'table';
        }
        var idTable = '#' + $(this).attr('id') + 'table';
        if (this.checked) {
            
            $(idTable).show();
            $(idTable2).hide();
        }
        else {
            $(idTable2).show();
            $(idTable1).hide();
        }
    });
</script>




