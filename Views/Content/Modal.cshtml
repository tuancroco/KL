@model List<KL.Models.DatabaseModels.CongViecCaNhan>

@{ 
    var tx = 1;
    var t = "";
    if (Model.Count > 0) {
        tx = Model.Count;
        t = Model.First().IDHoSoNhanSu;
    }


}
<div id="myModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span id="chutri" class="close">&times;</span>
            
        </div>
        <div class="modal-body">
            <div class="card-body toggle-on" id="0">
                <h1 style="color:green;">Da xong @(Model.Count(m => m.TrangThai == 3)*100 / tx )%</h1>
                <div class="table-responsive">
                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Stt</th>
                                <th>Ten Cong Viec</th>
                                <th>Noi Dung Tom Tat</th>
                                <th>Nguoi tham gia</th>
                                <th>File Dinh Kem</th>
                                <th>Thoi Han Hoan Thanh</th>
                                <th>Thoi Gian Hoan Thanh</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr class="@item.ID">
                                    <td></td>
                                    <td>@item.Ten</td>
                                    <td>@item.NoiDungCongViec</td>
                                    <td>@item.HoSoNhanSu.TenNhanSu</td>
                                    <td>@item.CongVanDinhKemCaNhan</td>
                                    <td>@item.ThoiHanHoanThanh</td>
                                    <td>@item.ThoiGianHoanThanh</td>
                                    <td>
                                        @{
                                            if (item.TrangThai == 2)
                                            {
                                                <button class="request">Request</button>
                                                <button class="reject">Reject</button>
                                            }
                                            else if (item.TrangThai == 3)
                                            {
                                                <p>Done</p>
                                            }
                                        }

                                    </td>
                                </tr>
                            }
                            <tr class="addMore">
                                <td></td>
                                <td><input type="text" " class="ten" /></td>
                                <td><input type="text"  class="nd" /></td>
                                <td id="dropdownlist"> @Html.DropDownList("employee", (IEnumerable<SelectListItem>)ViewBag.CategoryList, "select one")</td>
                                <td><input type="date" " class="tgian" /></td>
                            </tr>

                        </tbody>

                    </table>
                    <button id="addTask">Add task</button>
                </div>
            </div>
        </div>
        <div>
            <button class="btn-success" id="savePlan" type="button">Save</button>
        </div>
    </div>
    <script>
        $(document).click(function (event) {
            if (event.target == $('#myModal')[0]) {

                $('#myModal').hide();


            };

        });
        $('span#chutri').click(function () {
            $('#myModal').hide();
        });
        @{ 
            
        }
        $('button#savePlan').click(function () {
            var data = []; var i = 0;
            var x = refresh();
            $.ajax({
                                type: "POST",

                                url: "/Content/ShowWorkingPg?hosoId=@t",
                                success: function (data) {
                                    $('#tab').empty();
                                    $('#tab').append($(data));
                                }
                            });
            $('#myModal').hide();
            $('#myModal tbody .addMore').each(function () {
                var dropList = $(this).find('option:selected').val();
                var deadline = $(this).find('.tgian').val();
                 {
                    data[i] = {
                        Ten: $(this).find('.ten').val(),
                        Noidung: $(this).find('.nd').val(),
                        IDHs: dropList,
                        DeadLine: deadline
                    };
                    i++;
                }
                
               
            });
            var kh = new Object();
            kh.ID = planIndex;
            kh.newPlans = data;
            if (data.length > 0 ) {
                $.ajax({
                    url: '/Job/SaveNew',
                    type: 'POST',
                    data: { kh: kh },

                    success: function (response) {
                    }
                });
            }


        });
        $('#addTask').click(function () {
            var data1 = "<td>" + $('#dropdownlist').clone().html() + "</td>";
            var data = "<tr class='addMore'><td></td><td><input type='text'class='ten'/></td><td><input type='text'  class='nd'/></td>" + data1 + "<td>2011/04/25</td>" + "/<tr>";
            $('#myModal tbody').append(data);


        });
        var t = 1;
        $(".reject").click(function () {
            $("#phanHoi").show();
            t = $(this).closest("tr").attr("class");
            $(this).closest("td").replaceWith("<td><p style='color:red;'>success</p>");
        });
        $(".request").click(function () {
            t = $(this).closest("tr").attr("class");
            $(this).closest("td").replaceWith("<td><p style='color:red;'>success</p>");
            $.ajax({
                url: "/Job/SendRequest",
                data: { idJob: t, request:"",ma:2 },
                type: "POST",
                success: function () {
                    $('#phanHoi').hide();
                    
                }
            });
        });
        $(document).click(function (event) {
            if (event.target == $('#phanHoi')[0]) {

                $('#phanHoi').hide();
            };

        });
        $('span#chutri').click(function () {
            $('#myModal').hide();
        });

        $("#send").click(function () {
            var request = "";
            if ($("textarea").val() != null) request = $("textarea").val();

            $.ajax({
                url: "/Job/SendRequest",
                data: { request: request, idJob: t,ma:2},
                type: "POST",
                success: function () {
                    $('#phanHoi').hide();
                }
            });
        });    
    </script>
</div>
<div id="phanHoi" class="modal1">
    <div class="modal-content">
        <div class="modal-header">
            <span id="ph" class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Noi Dung Nhan Xet</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="">
                            <td><textarea rows="4" cols="50"></textarea></td>
                            
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div>
            <button class="btn-success" id="send" type="button">Send</button>
        </div>
    </div>
    <script>
        
    </script>
</div>